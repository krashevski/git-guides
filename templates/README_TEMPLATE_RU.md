# Набор для резервного копирования и восстановления Ubuntu

Набор для резервного копирования при переустановке ОС и последующего восстановления рабочей системы

## Состав

- `rsync-backup-userdata-v1.3.sh` — основной скрипт резервного копирования пользовательских данных
- `install-v1.3.sh`  — скрипт установки и проверки нужного ПО
- `backup_kit_ubuntu-22.04-v1.3.sh` — резервное копирование установленных пакетов и репозиториев ОС Ubuntu
- `rsync-restore-userdata-v1.3.sh` - восстановление данных пользователей
- `restore_ubuntu-22.04-v1.3.sh` — восстановления после переустановки ОС
- `README.md` — инструкция на английском
- `README_RU.md` — инструкция на русском языке
- `QUICKSTART.md` — короткая инструкция для быстрого старта

## Системные требования

- Ubuntu 22.04 (работоспособность на других версиях не гарантируется)
- Пакеты:
  - `rsync`
  - `screen`
  - `tar`
- Доступ: 
  - К графическому терминалу (для распаковки архива и базовой работы). 
  - К локальной консоли **TTY3** (вход под своим пользователем, ввод логина и пароля). 
  - Права суперпользователя (`sudo`) в графическом терминале для отдельных команд. 

## Установка

```bash
tar -xvzf backup_kit_mirror_logs.tar.gz
cd backup_kit_mirror_logs
bash install.sh
```

> [i] install.sh является обёрткой для скрипта install-v1.3.sh и автоматически проверяет наличие необходимых пакетов.

## Быстрый тест (только для проверки скрипта)

> [!] В финальной версии (для восстановления после переустановки ОС) этот раздел рекомендуется удалить.
```bash
rsync-backup.sh profile1
cat /home/user/log/backup.log
```

> [i] `rsync-backup.sh` является обёрткой для скрипта `rsync-backup-v1.3.sh` и автоматически проверяет наличие необходимых пакетов.

### Проверка скрипта

Проверка скрипта без изменения его кода:
```bash
./rsync-backup.sh profile1 --dry-run
```

Позволяет:
- проверить запуск и завершение screen-сессий,
- убедиться, что логи создаются в правильном месте,
- увидеть, какие файлы будут скопированы без фактического изменения.

Проверить сценарий с ошибкой (как работает блок с [ERROR]):
```bash
./rsync-backup.sh custom /fake/path test --dry-run
```

## Использование

### Войти в графический терминал (GUI) и распаковать архив, если это ещё не сделано:
```bash
tar -xvzf backup_kit_mirror_logs.tar.gz
cd backup_kit_mirror_logs
```

### Переключиться на локальную консоль TTY3:

Ctrl+Alt+F3

### Запустить скрипт:

```bash
rsync-backup.sh run
```

> [i] `rsync-backup.sh` является обёрткой для скрипта `rsync-backup-v1.3.sh` и автоматически проверяет наличие необходимых пакетов.

### После завершения переключиться в графический интерфейс:

Ctrl+Alt+F2

### Архивация одного из профилей:

```bash
rsync-backup.sh profile1
rsync-backup.sh profile2
rsync-backup.sh profile3
```

### Архивация произвольного каталога:

```bash
rsync-backup.sh /путь/к/каталогу
```

### Показать справку:

```bash
rsync-backup.sh -h
```

### Показать версию:

```bash
rsync-backup.sh -v
```

### Логи

Все операции записываются в файл:
```bash
cat /home/user/log/backup.log
```

## Восстановление

После переустановки Ubuntu можно восстановить сохранённые данные и список пакетов.

### Переключиться в графический интерфейс (Ctrl+Alt+F2), распаковать архив:

```bash
tar -xvzf backup_kit_mirror_logs.tar.gz
cd backup_kit_mirror_logs
```

### Запустить скрипт восстановления:

```bash
bash restore_ubuntu-22.04-v1.3.sh
```

### Следовать подсказкам скрипта:

- будут восстановлены профили и пользовательские данные,
- восстановлен список пакетов и репозиториев,
- при необходимости потребуется ввести пароль для `sudo`.

> [!] Рекомендуется запускать скрипт восстановления только на чистой установленной системе, чтобы избежать конфликтов.

> [OK] После завершения работы скрипта система будет готова к использованию.

## См. также

Для быстрого старта и примеров см. файл [QUICKSTART_RU.md](QUICKSTART_RU.md)
